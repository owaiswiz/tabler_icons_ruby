#!/usr/bin/env ruby
# frozen_string_literal: true

`curl 'https://github.com/tabler/tabler-icons/archive/refs/heads/master.zip' -L --output tabler_icons.zip`
`unzip -o tabler_icons.zip`
`mkdir -p icons`
`mv -f tabler-icons-master/icons/* icons/`
`rm -rf tabler-icons-master`
`rm tabler_icons.zip`

require "bundler/setup"
require 'nokogiri'
Dir['icons/**'].each do |icon|
  svg = File.read(icon)
  noko = Nokogiri::XML(svg)
  noko.remove_namespaces! # Don't need xmlns="xxx" for inline svgs
  noko.at_css("path[d='M0 0h24v24H0z']").remove # Tabler adds this invisible box for design tools to work nicely. Don't need it when browser renders inline svg
  noko.root.remove_attribute("width") # We'll add it later if needed
  noko.root.remove_attribute("height") # We'll add it later if needed

  string = noko.to_xhtml
  string = string.gsub(/\n\s*\n/, "\n") # Removing the path above keeps the new line, remove it.
  File.write(icon, string)
end